---
title: 文本模板转换过程
description: 了解文本模板转换过程采用文本模板文件作为输入，并生成新的文本文件作为输出。
ms.custom: SEO-VS-2020
ms.date: 11/04/2016
ms.topic: conceptual
helpviewer_keywords:
- text templates, transformation process
author: mgoertz-msft
ms.author: mgoertz
manager: jmartens
ms.technology: vs-ide-modeling
ms.workload:
- multiple
ms.openlocfilehash: 37bac2bc17e75dfb9c51bd5611706346c5cca154
ms.sourcegitcommit: b12a38744db371d2894769ecf305585f9577792f
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/13/2021
ms.locfileid: "126663860"
---
# <a name="the-text-template-transformation-process"></a>文本模板转换过程
文本模板转换过程采用文本模板文件作为输入，并生成新的文本文件作为输出。 例如，可以使用文本模板生成Visual Basic或 C# 代码，也可以生成 HTML 报表。

 三个组件参与此过程：引擎、主机和指令处理器。 引擎控制进程;它与主机和指令处理器交互以生成输出文件。 主机提供与环境的任何交互，例如定位文件和程序集。 指令处理器添加功能，例如从 XML 文件或数据库读取数据。

 文本模板转换过程通过两个步骤执行。 首先，引擎创建一个临时类，称为生成的转换类。 此类包含由 指令和控制块生成的代码。 之后，引擎将编译并执行生成的转换类以生成输出文件。

## <a name="components"></a>组件

|组件|说明|可自定义 (是/否) |
|-|-|-|
|引擎|引擎组件控制文本模板转换过程|否。|
|主机|主机是引擎和用户环境之间的接口。 Visual Studio是文本转换过程的宿主。|是的。 可以编写自定义主机。|
|指令处理器|指令处理器是处理文本模板中的指令的类。 可以使用 指令从输入源向文本模板提供数据。|是的。 可以编写自定义指令处理器|

## <a name="the-engine"></a>引擎
 引擎从主机接收模板作为字符串，该主机处理转换过程中使用的所有文件。 然后，引擎要求主机查找任何自定义指令处理器和环境的其他方面。 然后，引擎编译并运行生成的转换类。 引擎将生成的文本返回到主机，主机通常将文本保存到文件中。

## <a name="the-host"></a>主机
 主机负责与转换过程外部的环境相关的任何内容，包括：

- 定位引擎或指令处理器请求的文本和二进制文件。 主机可以搜索目录和全局程序集缓存以查找程序集。 主机可以找到引擎的自定义指令处理器代码。 主机还可以查找和读取文本文件，并返回其内容作为字符串。

- 提供引擎用于创建生成的转换类的标准程序集和命名空间的列表。

- 提供引擎编译和执行生成的转换类时使用的应用程序域。 使用单独的应用程序域来保护主机应用程序免受模板代码中的错误。

- 写入生成的输出文件。

- 设置生成的输出文件的默认扩展名。

- 处理文本模板转换错误。 例如，主机可以在用户界面中显示错误或将它们写入文件。  ("Visual Studio"中，错误将显示在"错误消息窗口.) 

- 如果用户在未提供值的情况下调用了 指令，则提供所需的参数值。 指令处理器可以指定 指令的名称和 参数，并要求主机提供默认值（如果有）。

## <a name="directives-and-directive-processors"></a>指令和指令处理器
 指令是文本模板中的命令。 它为生成过程提供参数。 指令通常定义模型或其他输入的源和类型，以及输出文件的文件扩展名。

 指令处理器可以处理一个或多个 指令。 转换模板时，必须已安装可处理模板中的指令的指令处理器。

 指令通过添加生成的转换类中的代码来工作。 从文本模板调用 指令，引擎在创建生成的转换类时处理所有指令调用。 成功调用 指令后，在文本模板中编写的其他代码可以依赖于 指令提供的功能。 例如，可以在模板中对 `import` 指令进行以下调用：

 `<#@ import namespace="System.Text" #>`

 标准指令处理器将此 转换为生成的 `using` 转换类中的 语句。 然后，可以在 `StringBuilder` 模板代码的其余部分使用 类，而无需将该类限定为 `System.Text.StringBuilder` 。
