---
title: CA2118:检查 SuppressUnmanagedCodeSecurityAttribute 用法
description: 公共或受保护类型或成员具有 System.Security.SuppressUnmanagedCodeSecurityAttribute 属性。
ms.date: 11/04/2016
ms.topic: reference
f1_keywords:
- CA2118
- ReviewSuppressUnmanagedCodeSecurityUsage
helpviewer_keywords:
- ReviewSuppressUnmanagedCodeSecurityUsage
- CA2118
ms.assetid: 4cb8d2fc-4e44-4dc3-9b74-7f5838827d41
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.technology: vs-ide-code-analysis
ms.workload:
- cplusplus
ms.openlocfilehash: 1d1f3a28b3b31aacea57cfa2fa5c4aa0150d3ad024b9ef7735b8b6e29cb48bb0
ms.sourcegitcommit: c72b2f603e1eb3a4157f00926df2e263831ea472
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/12/2021
ms.locfileid: "121455772"
---
# <a name="ca2118-review-suppressunmanagedcodesecurityattribute-usage"></a>CA2118:检查 SuppressUnmanagedCodeSecurityAttribute 用法

|项|“值”|
|-|-|
|RuleId|CA2118|
|Category|Microsoft.Security|
|重大更改|重大|

## <a name="cause"></a>原因
公共或受保护的类型或成员具有 <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName> 属性。

> [!NOTE]
> 此规则已被弃用。 有关详细信息，请参阅已 [弃用的规则](fxcop-unported-deprecated-rules.md)。

## <a name="rule-description"></a>规则说明

<xref:System.Security.SuppressUnmanagedCodeSecurityAttribute> 更改使用 COM 互操作或平台调用执行非托管代码的成员的默认安全系统行为。 通常，系统会 [授予非托管](/dotnet/framework/data/index) 代码的数据和建模权限。 每次调用成员时都会发生此需求，并检查调用堆栈中的每个调用方是否具有权限。 当属性存在时，系统将对权限进行链接[](/dotnet/framework/misc/link-demands)要求：当调用方进行 JIT 编译时，将检查直接调用方的权限。

该特性主要用于提高性能；不过，提高性能的同时会显著增加安全风险。 如果将 特性放在调用本机方法的公共成员上，则调用堆栈中的调用方 (而不是直接调用方) 不需要非托管代码权限来执行非托管代码。 根据公共成员的操作和输入处理，它可能会允许不受信任的调用方访问通常限制为可信代码的功能。

.NET 依赖于安全检查来防止调用方直接访问当前进程的地址空间。 由于此属性会绕过正常安全性，因此，如果代码可用于读取或写入进程的内存，则它会带来严重的威胁。 请注意，风险不限于有意提供进程内存访问权限的方法;它还存在于恶意代码可以通过任何方式实现访问的任何方案中，例如通过提供意外、格式错误或无效的输入。

默认安全策略不会向程序集授予非托管代码权限，除非程序集从本地计算机执行，或者是以下组之一的成员：

- 我的电脑区域代码组

- Microsoft 强名称代码组

- ECMA 强名称代码组

## <a name="how-to-fix-violations"></a>如何解决冲突

仔细检查代码，确保绝对有必要使用此属性。 如果不熟悉托管代码安全性，或者不了解使用此属性的安全隐患，请将其从代码中删除。 如果需要 属性，则必须确保调用方不会恶意使用代码。 如果代码无权执行非托管代码，则此属性不起作用，应将其删除。

## <a name="when-to-suppress-warnings"></a>何时禁止显示警告

若要安全地禁止显示此规则的警告，必须确保代码不向调用方提供对本机操作或资源的访问权限，这些资源以破坏性方式使用。

## <a name="example-1"></a>示例 1

下面的示例违反了规则。

:::code language="csharp" source="../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.TypesDoNotSuppress/cs/FxCop.Security.TypesDoNotSuppress.cs" id="Snippet1":::

## <a name="example-2"></a>示例 2

在下面的示例中， 方法提供平台调用方法 的可公开 `DoWork` 访问的代码路径 `FormatHardDisk` 。

:::code language="csharp" source="../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.PInvokeAndSuppress/cs/FxCop.Security.PInvokeAndSuppress.cs" id="Snippet1":::

## <a name="example-3"></a>示例 3

在下面的示例中，公共方法 `DoDangerousThing` 会导致冲突。 若要解决冲突， 应成为私有的，并且应该通过受安全要求保护的公共方法访问它，如 方法 `DoDangerousThing` `DoWork` 所示。

:::code language="csharp" source="../snippets/csharp/VS_Snippets_CodeAnalysis/FxCop.Security.TypeInvokeAndSuppress/cs/FxCop.Security.TypeInvokeAndSuppress.cs" id="Snippet1":::

## <a name="see-also"></a>另请参阅

- <xref:System.Security.SuppressUnmanagedCodeSecurityAttribute?displayProperty=fullName>
- [安全编码准则](/dotnet/standard/security/secure-coding-guidelines)
- [数据和建模](/dotnet/framework/data/index)
- [链接需求](/dotnet/framework/misc/link-demands)
