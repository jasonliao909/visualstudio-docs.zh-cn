---
title: 配置测试代理
description: 了解如何将代理设置为作为进程而非服务运行，以便运行与桌面交互的自动测试。
ms.custom: SEO-VS-2020
ms.date: 09/18/2018
ms.topic: how-to
helpviewer_keywords:
- agents, configuring for interaction with desktop
ms.assetid: 3a94dd07-6d17-402c-ae8f-7947143755c9
author: mikejo5000
ms.author: mikejo
manager: jmartens
ms.technology: vs-ide-test
ms.openlocfilehash: 238c266d11c1057ab59fe5296edc514cfdc2d937
ms.sourcegitcommit: b12a38744db371d2894769ecf305585f9577792f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/13/2021
ms.locfileid: "126736816"
---
# <a name="how-to-set-up-your-test-agent-to-run-tests-that-interact-with-the-desktop"></a>如何：设置测试代理以运行与桌面交互的测试

::: moniker range="vs-2017"
如果要运行的自动测试将与桌面交互，必须将代理设置为作为进程而非服务运行。 例如，如果想要使用测试控制器和测试代理远程运行编码的 UI 测试，或者想要运行测试并在运行测试时捕获视频录制，则必须将代理设置为作为进程运行。 使用 Visual Studio 将代理分配给测试设置中的角色时，或者使用 Microsoft 测试管理器将代理分配给环境中的角色时，对于分配给必须与桌面交互的角色的任何代理，必须为其更改设置。
::: moniker-end
::: moniker range=">=vs-2019"
如果要运行的自动测试将与桌面交互，必须将代理设置为作为进程而非服务运行。 例如，如果想要使用测试控制器和测试代理远程运行编码的 UI 测试，或者想要运行测试并在运行测试时捕获视频录制，则必须将代理设置为作为进程运行。 使用 Visual Studio 将代理分配给测试设置中的角色时，对于分配给要与桌面进行交互的角色的任何代理，必须更改相应的设置。
::: moniker-end

[!INCLUDE [web-load-test-deprecated](includes/web-load-test-deprecated.md)]

::: moniker range="vs-2017"
> [!WARNING]
> 如果使用 Microsoft 测试管理器设置实验室环境，则会安装测试代理。 可在“环境创建向导”中指定要配置某个角色以运行编码的 UI 测试  。
:::moniker-end

> [!IMPORTANT]
> 如果计算机正在运行代理，而您想要针对该代理运行编码的 UI 测试，则不能锁定该计算机，或者该计算机不能具有活动的屏幕保护程序。

如果运行的编码的 UI 测试将启动浏览器，则测试代理的服务帐户用于启动该浏览器。 此服务帐户必须是此计算机上某个活动用户的用户帐户。 如果不是同一用户帐户，浏览器将不会启动。

> [!IMPORTANT]
> 如果运行的编码的 UI 测试将作为生成定义的一部分启动浏览器，则生成服务的服务帐户用于启动该浏览器。 此服务帐户必须是此计算机上某个活动用户的用户帐户。 如果不是同一用户帐户，浏览器将不会启动。

使用以下过程可以设置分配给某角色的任何代理，该角色将执行需要与桌面交互的任务。

## <a name="to-set-up-an-agent-to-run-as-a-process"></a>将代理设置为作为进程运行

1. 若要将已安装的测试代理配置为作为进程运行，请选择“开始” > “Test Agent 配置工具”。  

   “配置测试代理”对话框随即显示  。

   ![配置 Visual Studio Test Agent 配置工具](media/configure-test-agent.png)

2. 选择“交互进程”  。 测试代理将作为进程启动，而不是作为服务启动。 选择“下一步”  。

3. 输入将运行测试代理进程的用户的用户名和密码。

   > [!NOTE]
   > - 对于您所添加的启动进程的用户，还必须将其添加为此代理的测试控制器计算机上 TeamTestAgentService 组的成员。 如果此用户是当前用户，则在向测试控制器计算机添加此用户时，你必须注销或重启。
   > - 用户帐户不支持空密码。
   > - 如果要使用 IntelliTrace 或网络仿真数据和诊断适配器，则用户帐户必须是 Administrators 组的成员。 如果运行测试代理的计算机正在运行具有最少特权用户帐户的操作系统，则还必须以管理员身份（提升的权限）运行该计算机。 如果代理用户名不在代理服务中，则它将尝试添加代理用户名，这需要有测试控制器权限。
   > - 尝试使用测试控制器的用户必须位于测试控制器的 Users 帐户中，否则他们将无法针对控制器运行测试。

4. 为了确保具有测试代理的计算机在重启之后可以运行测试，你可以设置计算机以便以测试代理用户身份自动登录。 选择“自动登录”  。 这会以加密形式将用户名和密码存储在注册表中。

   > [!NOTE]
   > 使用远程桌面或基于来宾的连接来连接到实验室环境时，可能会频繁地意外断开连接。 断开连接的一个原因有可能是因为计算机配置为自动登录到网络。

5. 因为屏幕保护可能会妨碍任何必须与桌面交互的自动测试，所以为了确保禁用屏幕保护，请选择“确保禁用屏幕保护”  。

   > [!WARNING]
   > 如果自动登录或禁用屏幕保护程序，则存在安全风险。 如果启用自动登录，则其他用户能够启动此计算机并能够使用自动登录的帐户。 如果禁用屏幕保护程序，则计算机可能不会提示用户通过登录来解锁计算机。 这样，任何能够实际接触到计算机的人员都可以访问该计算机。 如果在计算机上启用这些功能，则应该确保这些计算机位于安全的场所。 例如，这些计算机位于安全的实验室中。 如果清除“确保禁用屏幕保护”，则不会启用屏幕保护  。

   若要将代理改回作为服务运行，则可以使用此工具并选择“服务”  。

6. 若要应用所做的更改，请选择“应用设置”  。

   将显示“配置摘要”对话框，其中显示了配置测试代理的每个步骤的状态  。

7. 若要关闭“配置摘要”对话框中，请选择“关闭”   。 然后再次选择“关闭”以关闭“Test Agent 配置工具”   。

   > [!NOTE]
   > 在该计算机上有一个针对作为进程运行的测试代理而运行的通知区域图标。 它显示测试代理的状态。 如果代理作为使用此工具的进程运行，你可以启动、停止或重新启动代理。 要在测试代理未运行时将其作为进程启动，请依次选择“开始” > “Visual Studio” > “Microsoft Visual Studio Test Agent”    。

   ::: moniker range="vs-2017"
   如果向 Team Foundation Server 注册了此测试代理的测试控制器，则作为交互进程运行的测试代理的状态将显示在 Microsoft 测试管理器的“实验室中心”中的“控制器”视图中   。 如果列出时前面带有星号符号，则指示它正在作为交互进程运行。 要重启此测试代理，必须使用在计算机上针对测试代理而非“控制器”视图运行的工具  。
   ::: moniker-end

## <a name="see-also"></a>请参阅

- [安装和配置测试代理](../test/lab-management/install-configure-test-agents.md)
